\section{New Constructions}
We present our new constructions for both $\iprf$ and $\ioprf$.  To
ease readability, we omit an important technicality in the description
and proofs: our $\iprf$ and $\ioprf$ constructions do not output
pseudo-random bit strings of length $\lambda$, but pseudo-random
elements of DDH group $\myG$. Yet, converting elements to bit strings
follows from a standard application of the leftover hash
lemma~\cite{leftover}. As $|p|\geq\lambda$, we have
$|\myG|\ge{}2^\lambda$, and we silently assume in the following that
each party implicitly hashes the output of $\iprf$ and $\ioprf$ using
any pairwise independent family of hash functions.


\subsection{$\iprf$ Construction}
\label{sec:newprf}
\begin{construction}[Our iPRF]
  \label{const:newprf}
For any $\ell\in\N$, choose a key $K=(\vec{{\alpha}},\vec{\beta})$ by
sampling $\ell$ pairs of random scalars
$K_i=({\alpha_{i}},{\beta_{i}})\getr{}(\Z_p)^2.$ For any $\ell$ bit
input $x=x_1\ldots{}x_\ell$, we define function family
$\iprf_K(x_1,\ldots,x_\ell)=(f^1_{(\alpha_1,\beta_1)}(x_1),\ldots,f^\ell_{(\alpha_1,\beta_1),\ldots,(\alpha_\ell,\beta_\ell)}(x_1,\ldots,x_\ell))$,
where
\begin{align*}
f^i_{(\alpha_1,\beta_1),\ldots,(\alpha_i,\beta_i)} &=
g^{\prod_{x_i=1}\alpha_i \prod_{x_i=0}\beta_i}\\&=
g^{\prod_{j=1}^{i} (\alpha_jx_j+\beta_j(1-x_j))}.
\end{align*}
 
\ignore{Define the function ensemble $F' = \{F'_n\}_{n\in N}$.  For every $n$, a key of a function $F'_n$ is a tuple, $\langle P,Q,g,\vec{\alpha},\vec{\beta}\rangle$, 
where $P$ is an $n$-bit prime, $Q$ a prime divisor of $P-1$, $g$ an element of order $Q$ in $\mathbb{Z}_{p}^*$ and $\vec{\alpha}=\langle 
\alpha_0,\alpha_1, \ldots , \alpha_n \rangle$ and $\vec{\beta}=\langle 
\beta_0,\beta_1, \ldots ,\beta_n \rangle$, uniformly random sequences of $n+1$ elements of $\mathbb{Z}_Q$.  For any $n$-bit input, $x=x_1 x_2 \ldots x_n$, the 
function $f'_{P,Q,g,\vec{a},\vec{b}}$ is defined by:
$$f'_{P,Q,g,\vec{\alpha},\vec{\beta}}(x) =(g^{\alpha_0})^{\prod_{x_i=1}\alpha_i \prod_{x_i=0}\beta_i}$$
}%ignore
 \end{construction}

\todo{Show that this is a delegatable PRF.}

To show that our new $\iprf$ is actually an $\iprf$ according to
Definition~\ref{defiprf}, it is sufficient to show that each $f^i$ is
still a pseudo-random function.

\begin{theorem}
\label{theorem:newprf}
If the DDH-Assumption holds, then for every $i\leq\ell$ and for every
PPT distinguisher $\mathcal{D}$, there exists a negligible function
$\epsilon$ such that for sufficiently large $\lambda$
$$|
Pr[\mathcal{D}^{f^i_{(\alpha_1,\beta_1),\ldots,(\alpha_i,\beta_i)}}=1]
- Pr[\mathcal{D}^{R^i} = 1]| =\epsilon(\lambda), $$ where the
$(\alpha_1,\ldots_1),\ldots,(\alpha_i,\beta_i)$ are chosen randomly as
in Construction~\ref{const:newprf}, and $R^i$ is a randomly chosen
function from the set of functions with domain $\{0,1\}^i$ and image
$\myG$.
\ignore{
where in the first probability, $f'_{P,Q,g,\vec{a},\vec{\beta}}$ is distributed according to $F'_n$, and in the second probability the distribution of $R_{P,Q,g}$ is uniformly chosen in the set of functions with the domain $\{0,1\}^n$ and range $\langle g\rangle$.
}%ignore

\ignore{$$| Pr[\mathcal{M}^{f'_{P,Q,g,\vec{\alpha},\vec{\beta}}}(P,Q,g)=1] - Pr[\mathcal{M}^{R_{P,Q,g}}(P,Q,g) = 1]| < \frac{1}{n^\gamma} $$

where in the first probability, $f'_{P,Q,g,\vec{a},\vec{\beta}}$ is distributed according to $F'_n$, and in the second probability the distribution of $R_{P,Q,g}$ is uniformly chosen in the set of functions with the domain $\{0,1\}^n$ and range $\langle g\rangle$.
}%ignore
\end{theorem}

\begin{proof}
Fix any $i\leq\ell$ and consider $f^i$.  We prove the claim by
reduction, showing that if $\mathcal{D}$ exists that can distinguish
between $f^i$ and a random function $R^i$, then we can build
$\mathcal{D}'$ that can distinguish between $F_K$ from
Construction~\ref{nrprf} (on $i$ bit inputs and $i$ element keys) and a
random function $R$ (on $i$ bit inputs).

First, assume that $\mathcal{D}$ exists that can violate the
inequality from Theorem~\ref{theorem:newprf}.  We create
$\mathcal{D'}$ as follows.  First, $\mathcal{D}'$ creates and stores a
uniformly random vector $\vec{\beta}$ as in
Construction~\ref{const:newprf}.  $\mathcal{D}'$ then runs
$\mathcal{D}$ as a subroutine.  Each time $\mathcal{D}$ queries the
oracle for an evaluation on input $y\in\{0,1\}^i$, $\mathcal{D}'$ does the
following:

\begin{enumerate}
\item Query their own oracle for $y$ and receive back $z$.
\item Calculate $z' = z^{\prod_{y_i = 0} \beta_i}$.
\item Return $z'$ to $\mathcal{D}$.
\end{enumerate}

Eventually, $\mathcal{D}'$ outputs the same as $\mathcal{D}$.  If
$\mathcal{D}'$ is interacting with PRF $F_K$, then the $z'$ values
they give to $\mathcal{D}$ will be identical to function $f^i$, due to
them being able to multiply in the extra $\beta$ components.  If
$\mathcal{D}'$ is interacting with a real random function, then the
responses they give will be distributed identically to a random
function. \fixme{Yes, but why? There is one sentence of explanation
  missing.}  Therefore, if $\mathcal{D}$ has a distinguishing
advantage, so will $\mathcal{D}'$.
\end{proof}



\input{ioprf}

\subsection{OT-based $\proto$ Construction}

The $\iprf$ above can be computed as an oblivious PRF between a sender $S$ and a receiver $R$.  In this protocol,
the receiver $R$ has an array of bits $(x_1, \ldots, x_\ell)$ and wishes to compute $\iprf(x_1, \ldots, x_\ell)$ using
the key $K$ possessed by $S$.

Let $\ot(b, y_0, y_1)$ denote a secure 1-out-of-2 oblivious transfer protocol between $R$ and $S$ where
$S$ holds $y_0$ and $y_1$, $R$ holds $b\in\{0,1\}$, and $R$ obliviously retrieves $y_b$ from $S$.  The OT-based version of $\proto$ works as follows.

\begin{itemize}
\item $S$ generates $\ell$ random scalars $r_i\getr\Z_p$
\item For each $1 \leq i \leq \ell$, $R$ and $S$ execute $\ot(x_i, r_i\alpha_i, r_i\beta_i)$ and stores the result as $z_i$
\item $S$ sends to $R$ the vector $\vec{C}$ where $\forall 1 \leq i \leq \ell$, $C_i =  G \cdot \frac{1}{\prod_{j=1}^{i} r_j}$
\item $R$ recovers $\iprf$ output vector $v$ by calculating $v_i = C_i \cdot \prod_{j=1}^{i} z_j$
\end{itemize}


{\bf Correctness:} \todo{update notation} For all $1 \leq i \leq \ell$ we have
\begin{equation}
\begin{aligned}
v_i &= C_i \cdot \prod_{j=1}^{i} z_i \\
&= G \cdot \frac{1}{\prod_{j=1}^{i} a_j} \cdot \prod_{j=1}^{i} z_j \\
&= G \cdot \frac{1}{\prod_{j=1}^{i} a_j} \cdot \prod_{j=1}^{i} (a_jr_j)^{b_j}(a_js_j)^{1-b_j} a_j \\
&= G \cdot \prod_{j=1}^{i} r_j^{b_j}s_j^{1-b_j}
\end{aligned}
\end{equation}

\todo{Show that this is an OPRF. And show that the iterative evaluation is still secure.}


